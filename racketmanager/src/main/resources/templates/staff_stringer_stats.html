<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>張り人別 集計</title>
    <link rel="stylesheet" href="/css/staff_stringer_stats.css">
</head>
<body>

<header>
    <img src="/css/images/bones.jpg" class="logo">
</header>

<a th:href="@{/staff/orders}" class="back-btn">← 依頼一覧に戻る</a>

<h2>張り人別 集計</h2>

<div class="period">
    <p>対象期間：<span th:text="${start}"></span>〜<span th:text="${end}"></span></p>
</div>

<form method="get" action="/staff/stringer-stats">
    <select name="year" th:value="${year}">
        <option th:each="y : ${#numbers.sequence(2024,2035)}" th:value="${y}" th:text="${y}"></option>
    </select>年
    <select name="month" th:value="${month}">
        <option th:each="m : ${#numbers.sequence(1,12)}" th:value="${m}" th:text="${m}"></option>
    </select>月
    <button type="submit">表示</button>
</form>

<div class="table-wrapper">
<table border="1">
    <tr>
        <th>張り人</th><th>ポリエステル</th><th>ナイロン</th><th>ナチュラル</th><th>売上</th>
    </tr>
    <tr th:each="s : ${stringerStats}">
        <td th:text="${s.name}"></td>
        <td th:text="${s.poly}"></td>
        <td th:text="${s.nylon}"></td>
        <td th:text="${s.natural}"></td>
        <td th:text="${s.total}"></td>

        <!-- hidden for JS -->
        <input type="hidden" class="name" th:value="${s.name}">
        <input type="hidden" class="p" th:value="${s.poly}">
        <input type="hidden" class="n" th:value="${s.nylon}">
        <input type="hidden" class="na" th:value="${s.natural}">
    </tr>
</table>
</div>

<div class="chart-wrapper">
    <h3>張り人別グラフ</h3>
    <canvas id="stringerChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const names = [...document.querySelectorAll(".name")].map(e => e.value);
const poly = [...document.querySelectorAll(".p")].map(e => Number(e.value));
const nylon = [...document.querySelectorAll(".n")].map(e => Number(e.value));
const natural = [...document.querySelectorAll(".na")].map(e => Number(e.value));

new Chart(document.getElementById("stringerChart"), {
    type: "bar",
    data: {
        labels: names,
        datasets: [
            { label: "ポリエステル", data: poly },
            { label: "ナイロン", data: nylon },
            { label: "ナチュラル", data: natural }
        ]
    }
});
</script>

</body>
</html>
