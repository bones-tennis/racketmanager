<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>張り人 実績管理</title>
    <link rel="stylesheet" href="/css/staff_stringer_stats.css">
</head>
<body>

<header>
    <img src="/css/images/bones.jpg" class="logo">
</header>

<h2>張り人 実績管理</h2>

<!-- 戻るボタン -->
<div class="back-wrapper">
    <a href="/staff/orders" class="back-btn">← 依頼一覧へ戻る</a>
</div>

<!-- 対象期間 -->
<div class="period">
    <p>対象期間：<span th:text="${start}"></span> 〜 <span th:text="${end}"></span></p>
</div>

<!-- 年月フォーム -->
<form method="get" action="/staff/stringer-stats" class="select-form">
    <select name="year" th:value="${year}">
        <option th:each="y : ${#numbers.sequence(2024,2030)}"
                th:value="${y}" th:text="${y}">
        </option>
    </select>
    年

    <select name="month" th:value="${month}">
        <option th:each="m : ${#numbers.sequence(1,12)}"
                th:value="${m}" th:text="${m}">
        </option>
    </select>
    月

    <button type="submit">表示</button>
</form>

<!-- ============================
     hidden（JS 用）
     ============================ -->
<div th:each="s : ${stringerStats}">
    <input type="hidden" class="stringer-name" th:value="${s.name}">
    <input type="hidden" class="poly-val" th:value="${s.poly}">
    <input type="hidden" class="nylon-val" th:value="${s.nylon}">
    <input type="hidden" class="natural-val" th:value="${s.natural}">
</div>

<!-- ============================
     テーブル
     ============================ -->
<div class="table-wrapper">
<table class="stats-table" border="1">
    <tr>
        <th>張り人</th>
        <th>ポリエステル</th>
        <th>ナイロン</th>
        <th>ナチュラル</th>
        <th>売上合計</th>
    </tr>

    <tr th:each="s : ${stringerStats}">
        <td th:text="${s.name}"></td>
        <td th:text="${s.poly}"></td>
        <td th:text="${s.nylon}"></td>
        <td th:text="${s.natural}"></td>
        <td th:text="${s.total}"></td>
    </tr>
</table>
</div>

<!-- ============================
     グラフ
     ============================ -->
<div class="chart-wrapper">
    <h3>張り人別 張った本数</h3>
    <canvas id="stringerChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ===== hidden値を JS で取得 =====
const names   = Array.from(document.querySelectorAll(".stringer-name")).map(e => e.value);
const poly    = Array.from(document.querySelectorAll(".poly-val")).map(e => Number(e.value));
const nylon   = Array.from(document.querySelectorAll(".nylon-val")).map(e => Number(e.value));
const natural = Array.from(document.querySelectorAll(".natural-val")).map(e => Number(e.value));

const ctx = document.getElementById("stringerChart");

// ===== グラフ描画 =====
new Chart(ctx, {
    type: "bar",
    data: {
        labels: names,
        datasets: [
            {
                label: "ポリエステル",
                data: poly,
                backgroundColor: "rgba(54,162,235,0.6)"
            },
            {
                label: "ナイロン",
                data: nylon,
                backgroundColor: "rgba(75,192,192,0.6)"
            },
            {
                label: "ナチュラル",
                data: natural,
                backgroundColor: "rgba(255,206,86,0.6)"
            }
        ]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: { display: true, text: "本数" }
            }
        }
    }
});
</script>

</body>
</html>
