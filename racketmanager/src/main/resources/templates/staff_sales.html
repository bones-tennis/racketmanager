<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>売上管理</title>
    <link rel="stylesheet" href="/css/staff_sales.css">
</head>
<body>

<header>
    <img src="/css/images/bones.jpg" class="logo">
</header>

<h2>売上管理</h2>

<div class="top-buttons">
    <a th:href="@{/staff/orders}" class="back-btn">← 依頼一覧へ戻る</a>
</div>

<!-- 期間表示 -->
<div class="period">
    <p>対象期間：<span th:text="${start}"></span> 〜 <span th:text="${end}"></span></p>
</div>

<!-- 年月選択フォーム -->
<form method="get" action="/staff/sales" class="select-form">
    <select name="year" th:value="${year}">
        <option th:each="y : ${#numbers.sequence(2024,2035)}"
                th:value="${y}"
                th:text="${y}">
        </option>
    </select>
    年

    <select name="month" th:value="${month}">
        <option th:each="m : ${#numbers.sequence(1,12)}"
                th:value="${m}"
                th:text="${m}">
        </option>
    </select>
    月

    <button type="submit">表示</button>
</form>

<!-- 売上テーブル -->
<table class="sales-table">
    <tr><th>ガット種類</th><th>本数</th><th>売上</th></tr>

    <tr th:each="row : ${salesList}">
        <td th:text="${row.type}"></td>
        <td th:text="${row.count}"></td>
        <td th:text="${row.amount}"></td>

        <!-- JS 用 hidden -->
        <input type="hidden" class="type-name" th:value="${row.type}">
        <input type="hidden" class="count-val" th:value="${row.count}">
    </tr>

    <tr class="total">
        <td>合計</td>
        <td></td>
        <td th:text="${salesTotal}"></td>
    </tr>
</table>

<!-- グラフ -->
<div class="chart-wrapper">
    <h3>ガット種類別本数グラフ</h3>
    <canvas id="salesChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// hidden取得
const typeNames = Array.from(document.querySelectorAll(".type-name")).map(e => e.value);
const counts    = Array.from(document.querySelectorAll(".count-val")).map(e => Number(e.value));

new Chart(document.getElementById("salesChart"), {
    type: "bar",
    data: {
        labels: typeNames,
        datasets: [{
            label: "本数",
            data: counts
        }]
    }
});
</script>

</body>
</html>
