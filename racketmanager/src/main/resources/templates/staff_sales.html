<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>売上管理</title>
    <link rel="stylesheet" href="/css/staff_sales.css">
</head>
<body>

<header>
    <img src="/css/images/bones.jpg" class="logo">
</header>

<h2>売上管理</h2>

<div class="back">
    <a href="/staff/orders" class="back-btn">← 依頼一覧へ戻る</a>
</div>

<!-- 期間 -->
<div class="period">
    <p>対象期間：<span th:text="${start}"></span> 〜 <span th:text="${end}"></span></p>
</div>

<!-- 年月選択 -->
<form method="get" action="/staff/sales" class="select-form">
    <select name="year" th:value="${year}">
        <option th:each="y : ${#numbers.sequence(2024,2030)}"
                th:value="${y}" th:text="${y}">
        </option>
    </select> 年

    <select name="month" th:value="${month}">
        <option th:each="m : ${#numbers.sequence(1,12)}"
                th:value="${m}" th:text="${m}">
        </option>
    </select> 月

    <button type="submit">表示</button>
</form>

<!-- ===== 集計テーブル ===== -->
<table class="sales-table">
    <tr>
        <th>素材</th>
        <th>本数</th>
        <th>売上</th>
    </tr>
    <tr>
        <td>ポリエステル</td>
        <td th:text="${poly}"></td>
        <td th:text="${polyPrice} + ' 円'"></td>
    </tr>
    <tr>
        <td>ナイロン</td>
        <td th:text="${nylon}"></td>
        <td th:text="${nylonPrice} + ' 円'"></td>
    </tr>
    <tr>
        <td>ナチュラル</td>
        <td th:text="${natural}"></td>
        <td th:text="${naturalPrice} + ' 円'"></td>
    </tr>
    <tr class="total">
        <td>合計</td>
        <td></td>
        <td th:text="${salesTotal} + ' 円'"></td>
    </tr>
</table>

<!-- 隠し値（JS グラフ用） -->
<input type="hidden" id="poly-val" th:value="${poly}">
<input type="hidden" id="nylon-val" th:value="${nylon}">
<input type="hidden" id="natural-val" th:value="${natural}">
<input type="hidden" id="current-month" th:value="${month}">

<!-- グラフ -->
<div class="chart-wrapper">
    <h3>素材ごとの本数（棒グラフ＋折れ線）</h3>
    <canvas id="salesChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const poly = Number(document.getElementById("poly-val").value);
const nylon = Number(document.getElementById("nylon-val").value);
const natural = Number(document.getElementById("natural-val").value);
const currentMonth = Number(document.getElementById("current-month").value);

// 12ヶ月分の配列（初期値0）
let polyArr = Array(12).fill(0);
let nylonArr = Array(12).fill(0);
let naturalArr = Array(12).fill(0);

// 選択月だけ値をセット
polyArr[currentMonth - 1] = poly;
nylonArr[currentMonth - 1] = nylon;
naturalArr[currentMonth - 1] = natural;

const ctx = document.getElementById("salesChart").getContext("2d");

new Chart(ctx, {
    type: "bar",
    data: {
        labels: ["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],
        datasets: [
            {
                label: "ポリエステル",
                data: polyArr,
                backgroundColor: "rgba(255,99,132,0.5)"
            },
            {
                label: "ナイロン",
                data: nylonArr,
                backgroundColor: "rgba(54,162,235,0.5)"
            },
            {
                label: "ナチュラル",
                data: naturalArr,
                backgroundColor: "rgba(255,206,86,0.5)"
            },
            {
                type: "line",
                label: "合計（折れ線）",
                data: polyArr.map((v, i) => v + nylonArr[i] + naturalArr[i]),
                borderColor: "rgba(75,192,192,1)",
                borderWidth: 2,
                fill: false
            }
        ]
    }
});
</script>

</body>
</html>
