<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>売上管理</title>
    <link rel="stylesheet" href="/css/staff_sales.css">
</head>
<body>

<header>
    <img src="/css/images/bones.jpg" class="logo">
</header>

<h2>売上管理</h2>

<!-- 対象期間 -->
<div class="period">
    <p>対象期間：<span th:text="${start}"></span> 〜 <span th:text="${end}"></span></p>
</div>

<!-- 年月選択フォーム -->
<form method="get" action="/staff/sales" class="select-form">
    <select name="year" th:value="${year}">
        <option th:each="y : ${#numbers.sequence(2024,2030)}"
                th:value="${y}" th:text="${y}">
        </option>
    </select>
    年

    <select name="month" th:value="${month}">
        <option th:each="m : ${#numbers.sequence(1,12)}"
                th:value="${m}" th:text="${m}">
        </option>
    </select>
    月

    <button type="submit">表示</button>
</form>

<!-- 戻るボタン -->
<div class="back-wrapper">
    <a href="/staff/orders" class="back-btn">← 依頼一覧へ戻る</a>
</div>

<!-- hidden（JS に値を安全に渡す） -->
<input type="hidden" id="poly" th:value="${poly}">
<input type="hidden" id="nylon" th:value="${nylon}">
<input type="hidden" id="natural" th:value="${natural}">

<input type="hidden" id="polyPrice" th:value="${polyPrice}">
<input type="hidden" id="nylonPrice" th:value="${nylonPrice}">
<input type="hidden" id="naturalPrice" th:value="${naturalPrice}">

<input type="hidden" id="labelMonth" th:value="${month}">
<input type="hidden" id="labelYear" th:value="${year}">

<!-- 売上テーブル -->
<table class="sales-table">
    <tr><th>素材</th><th>本数</th><th>売上</th></tr>
    <tr>
        <td>ポリエステル</td>
        <td th:text="${poly}"></td>
        <td th:text="${polyPrice}"></td>
    </tr>
    <tr>
        <td>ナイロン</td>
        <td th:text="${nylon}"></td>
        <td th:text="${nylonPrice}"></td>
    </tr>
    <tr>
        <td>ナチュラル</td>
        <td th:text="${natural}"></td>
        <td th:text="${naturalPrice}"></td>
    </tr>
    <tr class="total">
        <td>合計</td>
        <td></td>
        <td th:text="${salesTotal}"></td>
    </tr>
</table>

<!-- グラフ -->
<div class="chart-wrapper">
    <h3>月別 張り本数 / 売上グラフ</h3>
    <canvas id="salesChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ==== hidden 値を JS で取得 ==== */
const poly = Number(document.getElementById("poly").value);
const nylon = Number(document.getElementById("nylon").value);
const natural = Number(document.getElementById("natural").value);

const polyPrice = Number(document.getElementById("polyPrice").value);
const nylonPrice = Number(document.getElementById("nylonPrice").value);
const naturalPrice = Number(document.getElementById("naturalPrice").value);

const year = document.getElementById("labelYear").value;
const month = document.getElementById("labelMonth").value;

/* ==== グラフ描画 ==== */
const ctx = document.getElementById("salesChart");

new Chart(ctx, {
    type: "bar",
    data: {
        labels: ["ポリエステル", "ナイロン", "ナチュラル"],
        datasets: [
            {
                label: "本数",
                data: [poly, nylon, natural],
                backgroundColor: "rgba(54, 162, 235, 0.6)",
                borderWidth: 1,
                yAxisID: "y"
            },
            {
                label: "売上（円）",
                type: "line",
                data: [polyPrice, nylonPrice, naturalPrice],
                borderColor: "rgba(255, 99, 132, 1)",
                borderWidth: 3,
                yAxisID: "y1"
            }
        ]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: { display: true, text: "本数" }
            },
            y1: {
                beginAtZero: true,
                position: "right",
                title: { display: true, text: "売上（円）" },
                grid: { drawOnChartArea: false }
            }
        }
    }
});
</script>

</body>
</html>
