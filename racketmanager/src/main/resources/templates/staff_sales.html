<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>売上管理</title>
    <link rel="stylesheet" href="/css/staff_sales.css">
</head>
<body>

<header>
    <img src="/css/images/bones.jpg" class="logo">
</header>

<h2>売上管理</h2>

<a th:href="@{/staff/orders}" class="back-btn">← 依頼一覧に戻る</a>

<div class="period">
    <p>対象期間：<span th:text="${start}"></span>〜<span th:text="${end}"></span></p>
</div>

<form method="get" action="/staff/sales" class="select-form">
    <select name="year" th:value="${year}">
        <option th:each="y : ${#numbers.sequence(2024,2035)}" th:value="${y}" th:text="${y}"></option>
    </select>年

    <select name="month" th:value="${month}">
        <option th:each="m : ${#numbers.sequence(1,12)}" th:value="${m}" th:text="${m}"></option>
    </select>月

    <button type="submit">表示</button>
</form>

<table class="sales-table">
    <tr>
        <th>素材</th><th>本数</th><th>売上</th>
    </tr>
    <tr>
        <td>ポリエステル</td>
        <td th:text="${poly}"></td>
        <td th:text="${polyPrice}"></td>
    </tr>
    <tr>
        <td>ナイロン</td>
        <td th:text="${nylon}"></td>
        <td th:text="${nylonPrice}"></td>
    </tr>
    <tr>
        <td>ナチュラル</td>
        <td th:text="${natural}"></td>
        <td th:text="${naturalPrice}"></td>
    </tr>
    <tr class="total">
        <td>合計</td><td></td><td th:text="${salesTotal}"></td>
    </tr>
</table>

<!-- hidden inputs for JS -->
<input type="hidden" id="polyYear" th:value="${polyYear}">
<input type="hidden" id="nylonYear" th:value="${nylonYear}">
<input type="hidden" id="naturalYear" th:value="${naturalYear}">

<div class="chart-wrapper">
    <h3>年間 張り本数グラフ</h3>
    <canvas id="salesChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const p = document.getElementById('polyYear').value.replace(/[\[\]]/g,'').split(',').map(Number);
const n = document.getElementById('nylonYear').value.replace(/[\[\]]/g,'').split(',').map(Number);
const na = document.getElementById('naturalYear').value.replace(/[\[\]]/g,'').split(',').map(Number);

new Chart(document.getElementById('salesChart'), {
    type: 'bar',
    data: {
        labels: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],
        datasets: [
            { label: 'ポリエステル', data: p },
            { label: 'ナイロン', data: n },
            { label: 'ナチュラル', data: na }
        ]
    }
});
</script>

</body>
</html>
