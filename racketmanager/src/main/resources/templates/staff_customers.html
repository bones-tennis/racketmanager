<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="/css/side_menu.css">
  <script src="/js/side_menu.js" defer></script>
  <title>顧客管理</title>
  <link rel="stylesheet" href="/css/staff_customers.css">
</head>
<body>
  <div th:replace="side_menu :: sideMenu"></div>

  <h2>顧客一覧</h2>

  <!-- 🔸 検索フォーム -->
  <form th:action="@{/staff/customers}" method="get" class="search-form">
    <input type="text" name="keyword" placeholder="ユーザー名で検索" th:value="${keyword}">
    <button type="submit">検索</button>
  </form>

  <div class="table-wrapper">
    <table border="1">
      <tr>
        <th>ユーザー名</th>
        <th>LINE連携</th>
        <th>操作</th>
      </tr>

      <tr th:each="c : ${customers}">
        <!-- ユーザー名（復号済み） -->
        <td th:text="${c.usernameDecrypted}"></td>

        <!-- LINE連携状態 -->
        <td>
          <span th:if="${c.lineUserId != null}" class="line-linked">
            連携済み
          </span>
          <span th:if="${c.lineUserId == null}" class="line-not-linked">
            未連携
          </span>
        </td>

        <!-- 操作 -->
        <td>
          <a th:href="@{|/staff/customers/${c.id}/edit|}" class="edit-btn">
            編集
          </a>
          <form th:action="@{|/staff/customers/${c.id}/delete|}"
                method="post"
                style="display:inline;"
                onsubmit="return confirm('削除しますか？')">
            <button type="submit" class="delete-btn">削除</button>
          </form>
        </td>
      </tr>
    </table>
  </div>

</body>
</html>
